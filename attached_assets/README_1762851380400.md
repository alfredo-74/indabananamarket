# Fixed Files for Fly.io Deployment

## Files to Update

Download all these files and upload them to your GitHub repository:

### 1. package.json
- Location: **Root of repository**
- Replace your existing `package.json`
- Key change: Updated build script to compile all three TypeScript files

### 2. server-index.ts
- Save as: **server/index.ts**
- Replace your existing `server/index.ts`
- Key changes: Dynamic imports for vite-dev and vite-prod

### 3. server-vite-prod.ts
- Save as: **server/vite-prod.ts**
- Create this NEW file in the `server/` folder
- Purpose: Production static file serving (no Vite dependencies)

### 4. server-vite-dev.ts
- Save as: **server/vite-dev.ts**
- Create this NEW file in the `server/` folder
- Purpose: Development Vite server setup

## How to Upload to GitHub

### Option A: GitHub Web Interface

1. Go to your repo: https://github.com/alfredo-74/indabananamarket
2. For `package.json`:
   - Click on `package.json`
   - Click the pencil icon (Edit)
   - Replace all content with the downloaded file
   - Commit changes
3. For `server/index.ts`:
   - Navigate to `server/index.ts`
   - Click the pencil icon (Edit)
   - Replace all content with `server-index.ts`
   - Commit changes
4. For NEW files (`vite-prod.ts` and `vite-dev.ts`):
   - Navigate to the `server/` folder
   - Click "Add file" â†’ "Create new file"
   - Name it `vite-prod.ts` (or `vite-dev.ts`)
   - Paste the content from downloaded file
   - Commit changes

### Option B: Git Command Line (if you have local clone)

```bash
# Copy files to your local repo
cp package.json /path/to/your/repo/
cp server-index.ts /path/to/your/repo/server/index.ts
cp server-vite-prod.ts /path/to/your/repo/server/vite-prod.ts
cp server-vite-dev.ts /path/to/your/repo/server/vite-dev.ts

# Commit and push
git add package.json server/
git commit -m "Fix Vite build for production deployment"
git push
```

## What This Fixes

1. **Separates Vite dependencies**: Development-only Vite code is in `vite-dev.ts`, production code in `vite-prod.ts`
2. **Dynamic imports**: Only loads Vite code in development mode
3. **Proper build**: All three TypeScript files are compiled into the `dist/` folder
4. **No more Vite errors**: Production won't try to load Vite package

## After Uploading

1. Wait 2-3 minutes for Fly.io to detect the changes
2. Fly.io will automatically rebuild and redeploy
3. Check logs at: https://fly.io/apps/indabananamarket/monitoring
4. You should see the server start successfully!

## Expected Success Log

```
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.js
12:34:56 PM [express] serving on port 3000
```

## If You Still See Errors

Share the latest logs and I'll help you debug further!
